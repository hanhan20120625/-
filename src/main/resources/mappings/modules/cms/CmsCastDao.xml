<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.msframe.modules.cms.dao.CmsCastDao">
    
	<sql id="cmsCastColumns">
		a.id AS "id",
		a.name AS "name",
		a.cp_castid AS "cpCastid",
		a.person_display_name AS "personDisplayName",
		a.person_sort_name AS "personSortName",
		a.person_search_name AS "personSearchName",
		a.firstname AS "firstname",
		a.middlename AS "middlename",
		a.lastname AS "lastname",
		a.sex AS "sex",
		a.birthday AS "birthday",
		a.hometown AS "hometown",
		a.education AS "education",
		a.height AS "height",
		a.weight AS "weight",
		a.blood_group AS "bloodGroup",
		a.marriage AS "marriage",
		a.favorite AS "favorite",
		a.webpage AS "webpage",
		a.description AS "description",
		a.cms_state AS "cmsState",
		a.status AS "status",
		a.sort AS "sort",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.del_flag AS "delFlag",
		a.remarks AS "remarks",
		a.remark1 AS "remark1",
		a.sync_state AS "syncState"
	</sql>
	
	<sql id="cmsCastJoins">
	</sql>
	
    
	<select id="get" resultType="CmsCast" >
		SELECT 
			<include refid="cmsCastColumns"/>
		FROM cms_cast a
		<include refid="cmsCastJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="CmsCast" >
		SELECT 
			<include refid="cmsCastColumns"/>
		FROM cms_cast a
		<include refid="cmsCastJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="name != null and name != ''">
				AND a.name LIKE 
					<if test="dbName == 'oracle'">'%'||#{name}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{name}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{name},'%')</if>
			</if>
			<if test="personDisplayName != null and personDisplayName != ''">
				AND a.person_display_name = #{personDisplayName}
			</if>
			<if test="personSearchName != null and personSearchName != ''">
				AND a.person_search_name = #{personSearchName}
			</if>
			<if test="firstname != null and firstname != ''">
				AND a.firstname = #{firstname}
			</if>
			<if test="status != null and status !='' or status==0">
				AND a.status = #{status}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.sort DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="CmsCast" >
		SELECT 
			<include refid="cmsCastColumns"/>
		FROM cms_cast a
		<include refid="cmsCastJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.sort ASC
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO cms_cast(
			id,
			name,
			cp_castid,
			person_display_name,
			person_sort_name,
			person_search_name,
			firstname,
			middlename,
			lastname,
			sex,
			birthday,
			hometown,
			education,
			height,
			weight,
			blood_group,
			marriage,
			favorite,
			webpage,
			description,
			cms_state,
			status,
			sort,
			create_by,
			create_date,
			update_by,
			update_date,
			del_flag,
			remarks,
			remark1,
			sync_state
		) VALUES (
			#{id},
			#{name},
			#{cpCastid},
			#{personDisplayName},
			#{personSortName},
			#{personSearchName},
			#{firstname},
			#{middlename},
			#{lastname},
			#{sex},
			#{birthday},
			#{hometown},
			#{education},
			#{height},
			#{weight},
			#{bloodGroup},
			#{marriage},
			#{favorite},
			#{webpage},
			#{description},
			#{cmsState},
			#{status},
			#{sort},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{delFlag},
			#{remarks},
			#{remark1},
			#{syncState}
		)
	</insert>
	
	<update id="update">
		UPDATE cms_cast SET 	
			name = #{name},
			cp_castid = #{cpCastid},
			person_display_name = #{personDisplayName},
			person_sort_name = #{personSortName},
			person_search_name = #{personSearchName},
			firstname = #{firstname},
			middlename = #{middlename},
			lastname = #{lastname},
			sex = #{sex},
			birthday = #{birthday},
			hometown = #{hometown},
			education = #{education},
			height = #{height},
			weight = #{weight},
			blood_group = #{bloodGroup},
			marriage = #{marriage},
			favorite = #{favorite},
			webpage = #{webpage},
			description = #{description},
			cms_state = #{cmsState},
			status = #{status},
			sort = #{sort},
			update_by = #{updateBy.id},
			update_date = #{updateDate},
			remarks = #{remarks},
			remark1 = #{remark1},
			sync_state = #{syncState}
		WHERE id = #{id}
	</update>
	
	
	<!--物理删除-->
	<update id="delete">
		DELETE FROM cms_cast
		WHERE id = #{id}
	</update>
	
	<!--逻辑删除-->
	<update id="deleteByLogic">
		UPDATE cms_cast SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	
	
	<!-- 根据实体名称和字段名称和字段值获取唯一记录 -->
	<select id="findUniqueByProperty" resultType="CmsCast" statementType="STATEMENT">
		select * FROM cms_cast  where ${propertyName} = '${value}'
	</select>

	<!-- 排序功能 Begin -->
	<!-- 读取上一条数据 -->
	<select id="selectTopSort" resultType="java.lang.Long">
		SELECT sort FROM cms_cast WHERE sort !=''
		<include refid="condition"/>
		ORDER BY sort ASC limit 0,1
	</select>

	<select id="selectPreviousSort" resultType="java.util.Map" parameterType="java.util.Map">
		SELECT id,sort FROM cms_cast WHERE sort &gt; #{sort}
		<include refid="condition"/>
		ORDER BY sort ASC limit 0,1
    </select>

	<!-- 读取下一条数据 -->
	<select id="selectNextSort" resultType="java.util.Map" parameterType="java.util.Map">
		  SELECT id,sort FROM cms_cast WHERE sort &lt; #{sort}
		  <include refid="condition"/>
		  ORDER BY sort DESC limit 0,1
	</select>

	<!-- 修改当前数据的排序 -->
	<update id="updateSelfSort" parameterType="java.util.Map">
		UPDATE cms_cast SET sort = #{sort} WHERE id = #{id}
		<include refid="condition"/>
	</update>

	<!-- 修改当前的上一条、下一条的排序数据 -->
	<update id="updateOtherSort" parameterType="java.util.Map">
		UPDATE cms_cast SET sort = #{sort} WHERE  sort = #{origianlSort}
		<include refid="condition"/>
	</update>
	<!-- 排序功能 End -->
	<sql id="condition">
		<if test="name != null and name != ''">
			name = #{name}
		</if>
		<if test="hometown != null and hometown != ''">
			AND hometown = #{hometown}
		</if>
		<if test="education != null and education !=''">
			AND education = #{education}
		</if>
		<if test="status != null and status != ''">
			AND status = #{status}
		</if>
	</sql>
</mapper>